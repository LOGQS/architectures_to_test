
*Will add more data and notes as necessary. For now, just a simple note file*


### Creation date: 10.07.2025

### Creation method: AI generated based on instructions, later tweaked/fixed manually 

## End of implementation Notes:

| #                                                         | Check                  | Result            | Reasoning                                                                                                                                                                                                                                                                                         |
| --------------------------------------------------------- | ---------------------- | ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1                                                         | Tests pass             | ✔                 | All 12 custom tests succeed on CPU and CUDA.                                                                                                                                                                                                                                                      |
| 2                                                         | Buffer integrity       | ✔                 | `self.state` remains a registered buffer after forward; checkpoint-save/load verified.                                                                                                                                                                                                            |
| 3                                                         | Autograd safety        | ✔                 | No in-place mutation of tensors that require grad; gradient flow confirmed for all 13 learnable parameters (tests).                                                                                                                                                                               |
| 4                                                         | Gating gradients       | ✔                 | Straight-through top-k now delivers gradients to `gate_proj.weight`; coverage test shows 13/13.                                                                                                                                                                                                   |
| 5                                                         | Strict *k* active      | ✔                 | Boolean mask built directly from `topk_idx`; exactly `k_active` columns per batch row.                                                                                                                                                                                                            |
| 6                                                         | State update & TBPTT   | ⚠ (Design choice) | `h = self.state.clone()` keeps graph; assigning `self.state = h` **inside `torch.no_grad()` detaches the write op but *not* the tensor** – gradients can back-prop across ticks unless user calls `reset_state`. If full back-prop is undesirable, caller must detach periodically. Not a defect. |
| 7                                                         | Numerical / dtype      | ✔                 | RMSNorm ε, FiLM tanh, and softmax all stable; dtype tests pass.                                                                                                                                                                                                                                   |
| 8                                                         | Computational path     | ⚠ (Efficiency)    | Default path still runs `core()` and full MHA on all N columns (O(N²)); the sparse branches are behind `model._optimize_active = True`. This is intentional, not wrong; switch it on when scaling.                                                                                                |
| 9                                                         | Alignment with concept | ✔                 | • Thousands of stateful columns • Differentiable gating & lateral bus • Per-column path-integration possible via state • Hence fits the Thousand-Brains design discussed earlier. |                        |                   |                                                                                                                                                                                                                                                                                                   |
